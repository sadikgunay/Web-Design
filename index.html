<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        feather.replace();

        function initIndex() {
            // √ñNCE VERƒ∞ KONTROL√ú YAPILMALI
            verileriYukleVeKontrolEt(); 
            
            // SONRA SLIDER VE Lƒ∞STELER OLU≈ûTURULMALI
            slideriOlustur(); 
            vitriniGuncelle();
            duyurulariGuncelle();
            
            // Slider Animasyonlarƒ±
            const myCarousel = document.getElementById('anaSlider');
            function startTextAnimations(carouselItem) {
                carouselItem.querySelectorAll('.hero-txt-slide').forEach(el => {
                    el.style.animation = 'none';
                    el.offsetHeight; 
                });
                carouselItem.querySelectorAll('.hero-txt-slide').forEach((el, i) => {
                    const delay = (i * 0.15) + 0.2; 
                    el.style.animation = `maskedSlideUp 0.8s cubic-bezier(0.25, 1, 0.5, 1) forwards ${delay}s`;
                });
            }
            myCarousel.addEventListener('slid.bs.carousel', function (event) { 
                startTextAnimations(event.relatedTarget);
            });
            const initialActive = myCarousel.querySelector('.carousel-item.active');
            if(initialActive) startTextAnimations(initialActive);
            
            // Acil Duyuru Kontrol√º
            const duyurular = JSON.parse(localStorage.getItem('saaturnDuyurular')) || [];
            if(duyurular.length > 0) {
                const sonDuyuru = duyurular[0]; 
                if(sonDuyuru.etiket === "ACƒ∞L") {
                    document.getElementById('uTitle').innerText = sonDuyuru.baslik;
                    document.getElementById('uContent').innerText = sonDuyuru.icerik;
                    if(sonDuyuru.resim && sonDuyuru.resim !== "Yok") {
                        document.getElementById('uImg').src = sonDuyuru.resim;
                        document.getElementById('uImgContainer').style.display = 'block';
                    }
                    setTimeout(() => {
                        new bootstrap.Modal(document.getElementById('acilModal')).show();
                    }, 1000);
                }
            }

            window.addEventListener('scroll', reveal);
            window.addEventListener('scroll', handleNavbar);
            reveal(); 
        }

        // --- KRƒ∞Tƒ∞K D√úZELTME BURADA ---
        function verileriYukleVeKontrolEt() {
            // 1. Mevcut veriyi √ßekmeye √ßalƒ±≈ü
            const mevcutVeri = localStorage.getItem('saaturnUrunler');

            // 2. EƒûER VERƒ∞ ZATEN VARSA, Hƒ∞√áBƒ∞R ≈ûEY YAPMADAN √áIK (Return)
            // Bu sayede Admin panelinden eklediklerin silinmez.
            if (mevcutVeri !== null && mevcutVeri !== "[]") {
                console.log("Mevcut veri korundu.");
                return; 
            }

            // 3. SADECE VERƒ∞ YOKSA (ƒ∞lk defa giriliyorsa) Varsayƒ±lanlarƒ± Y√ºkle
            const varsayilanUrunler = [
                { id: 1, ad: "Sat√ºrn ELITE", kat: "Prestige Series", fiyat: 24000, img: "assets/img/gallery/watch-gold.png", badge: "Vƒ∞TRƒ∞N YILDIZI", filter: "prestige limited", desc: "L√ºks ve zarafetin simgesi. Altƒ±n kaplama detaylar.", teknik: { mekanizma: "Otomatik (ƒ∞svi√ßre)", kasa: "38mm Altƒ±n Kaplama", cam: "Safir", su: "10 ATM" } },
                { id: 2, ad: "Sat√ºrn PRESTIGE", kat: "Prestige Series", fiyat: 18500, img: "assets/img/gallery/watch-1.png", badge: "√áOK SATAN", desc: "Profesyonellerin tercihi √ßelik kasa.", teknik: { mekanizma: "Otomatik (Japon)", kasa: "42mm √áelik", cam: "Safir", su: "5 ATM" } },
                { id: 3, ad: "Sat√ºrn OCEAN", kat: "Sport / Diver", fiyat: 12400, img: "assets/img/gallery/watch-2.png", badge: "", filter: "sport", desc: "Derinlerin hakimi dalgƒ±√ß saati.", teknik: { mekanizma: "Otomatik", kasa: "44mm Titanyum", cam: "Hardlex", su: "30 ATM" } },
                { id: 4, ad: "Sat√ºrn TIMELESS", kat: "Classic", fiyat: 9250, img: "assets/img/gallery/watch-3.png", badge: "", filter: "classic", desc: "Klasik deri kordonlu tasarƒ±m.", teknik: { mekanizma: "Quartz", kasa: "40mm √áelik", cam: "Mineral", su: "5 ATM" } },
                { id: 5, ad: "Sat√ºrn NEBULA", kat: "Limited Edition", fiyat: 14000, img: "assets/img/gallery/watch-4.png", badge: "SINIRLI", desc: "Uzay √ßaƒüƒ± tasarƒ±mƒ±, karbon fiber kadran.", teknik: { mekanizma: "Mekanik", kasa: "45mm Karbon", cam: "Safir", su: "10 ATM" } },
                { id: 6, ad: "Sat√ºrn TITAN", kat: "Elite Series", fiyat: 22500, img: "assets/img/gallery/watch-5.png", badge: "YENƒ∞", desc: "Titanyum g√∂vde ve ƒ∞svi√ßre mekanizmasƒ±.", teknik: { mekanizma: "Otomatik", kasa: "44mm Titanyum", cam: "Safir", su: "20 ATM" } }
            ];
            localStorage.setItem('saaturnUrunler', JSON.stringify(varsayilanUrunler));
            console.log("Varsayƒ±lan veriler y√ºklendi.");
        }
        
        function slideriOlustur() {
            // Hata √ñnleyici: Eƒüer veri yoksa bo≈ü dizi ata
            const urunler = JSON.parse(localStorage.getItem('saaturnUrunler')) || [];
            
            const container = document.getElementById('sliderIcerik');
            const indicators = document.getElementById('sliderIndicators');
            container.innerHTML = "";
            indicators.innerHTML = "";
            
            // Slider i√ßin se√ßilecek √ºr√ºn ID'leri
            const sliderIds = [3, 4, 1];
            
            // Sadece mevcut olan √ºr√ºnleri slider'a ekle (Silinenler hata vermesin)
            const sliderUrunleri = sliderIds.map(id => urunler.find(u => u.id == id)).filter(item => item !== undefined);

            // Eƒüer hi√ß √ºr√ºn kalmamƒ±≈üsa slider bo≈ü kalmasƒ±n diye uyarƒ± koyma (Opsiyonel)
            if(sliderUrunleri.length === 0 && urunler.length > 0) {
                // Eƒüer √∂zel ID'li √ºr√ºnler silindiyse listedeki ilk √ºr√ºn√º slider yap
                sliderUrunleri.push(urunler[0]);
            }

            sliderUrunleri.forEach((u, index) => {
                const activeClass = index === 0 ? "active" : "";
                indicators.innerHTML += `<button type="button" data-bs-target="#anaSlider" data-bs-slide-to="${index}" class="${activeClass}"></button>`;
                
                let ozellikHTML = '';
                if(u.teknik) {
                    const ozellikler = [
                        {key: "Mekanizma", value: u.teknik.mekanizma},
                        {key: "Kasa", value: u.teknik.kasa},
                        {key: "Cam", value: u.teknik.cam},
                        {key: "Su Direnci", value: u.teknik.su}
                    ];
                    
                    ozellikler.forEach(o => {
                        ozellikHTML += `
                            <div class="col-6 col-md-3">
                                <p class="text-gold-gradient fw-bold mb-0" style="font-size: 0.75rem; letter-spacing: 1px;">${o.key}</p>
                                <p class="text-white small fw-light">${o.value}</p>
                            </div>
                        `;
                    });
                }
                
                const slideHTML = `
                <div class="carousel-item ${activeClass}" data-bs-interval="6000" onclick="window.location.href='urun-detay.html?id=${u.id}'">
                    <div class="hero-bg"></div>
                    <div class="container hero-content">
                        <div class="row w-100 align-items-center justify-content-center">
                            
                            <div class="col-lg-6 text-lg-start text-center z-2 order-2 order-lg-1">
                                <div class="text-mask-container hero-txt-1">
                                    <p class="hero-txt-slide text-gold mb-2 text-uppercase fw-bold" style="color:#BF953F; letter-spacing: 3px; font-size:0.9rem;">‚Äî ${u.kat}</p>
                                </div>
                                <div class="text-mask-container hero-txt-2">
                                    <h1 class="hero-txt-slide display-huge text-white mb-3 fw-bold">${u.ad}</h1>
                                </div>
                                <div class="text-mask-container hero-txt-3">
                                    <p class="hero-txt-slide lead text-light mb-4 opacity-75 fw-light fs-6" style="max-width:550px; margin: 0 auto 0 0;">
                                        ${u.desc || "√ñzel tasarƒ±m saat koleksiyonu."}
                                    </p>
                                </div>
                                
                                <div class="row mt-5 border-start border-secondary py-3 text-start">
                                    ${ozellikHTML}
                                </div>
                                <div class="hero-btn mt-4 text-center text-lg-start">
                                    <h3 class="text-white serif-font mb-4">${parseInt(u.fiyat).toLocaleString()} ‚Ç∫</h3>
                                    <span class="btn-gold-outline">ƒ∞NCELE & SATIN AL</span>
                                </div>
                            </div>

                            <div class="col-lg-6 text-center z-2 order-1 order-lg-2">
                                <img src="${u.img}" class="hero-product-img" alt="${u.ad}" onerror="this.style.display='none'">
                            </div>

                        </div>
                    </div>
                </div>`;
                container.innerHTML += slideHTML;
            });
        }

        function vitriniGuncelle() {
            const urunler = JSON.parse(localStorage.getItem('saaturnUrunler')) || [];
            const wrapper = document.getElementById('vitrinListesi');
            wrapper.innerHTML = "";

            // Vitrinde g√∂sterilecek √ºr√ºnler (Varsa ID 2,5,6 yoksa ilk 3 √ºr√ºn)
            let vitrinData = urunler.filter(u => [2, 5, 6].includes(Number(u.id)));
            if(vitrinData.length === 0 && urunler.length > 0) {
                vitrinData = urunler.slice(0, 3);
            }

            vitrinData.forEach(u => {
                const kart = `
                <div class="col-12 col-md-6 col-lg-4 reveal">
                    <div class="product-card">
                        <div class="text-center mb-3 position-relative">
                            <span class="badge bg-warning text-dark position-absolute top-0 end-0 mt-2 me-2 rounded-0">${u.badge || ''}</span>
                            <img src="${u.img}" class="product-img" alt="${u.ad}" onerror="this.src='https://via.placeholder.com/300x300?text=G√∂rsel+Yok'">
                        </div>
                        <div class="text-center mt-3">
                            <h4 class="text-white serif-font h4 mb-1">${u.ad}</h4>
                            <p class="text-secondary small text-uppercase" style="letter-spacing: 1px;">${u.kat}</p>
                            <div class="price-tag serif-font">${parseInt(u.fiyat).toLocaleString()} ‚Ç∫</div>
                            <a href="urun-detay.html?id=${u.id}" class="btn-gold-outline mt-2 w-100 d-block" style="padding: 10px; font-size: 0.8rem;">ƒ∞NCELE</a>
                        </div>
                    </div>
                </div>`;
                wrapper.innerHTML += kart;
            });
        }

        function duyurulariGuncelle() {
            let duyurular = JSON.parse(localStorage.getItem('saaturnDuyurular')) || [];
            if(duyurular.length === 0) {
                duyurular = [ 
                    { baslik: "Sat√ºrn 2026 Kataloƒüu", icerik: "Yeni kataloƒüumuz yayƒ±nda.", tarih: "10.12.2025", etiket: "√ñNEMLƒ∞", dosyaAd: "Katalog.pdf", resim: "Yok" },
                    { baslik: "Sezon ƒ∞ndirimi", icerik: "%20 ƒ∞ndirim Fƒ±rsatƒ± ba≈üladƒ±.", tarih: "30.11.2025", etiket: "ƒ∞NDƒ∞Rƒ∞M", dosyaAd: "Yok", resim: "Yok" } 
                ];
                localStorage.setItem('saaturnDuyurular', JSON.stringify(duyurular));
            }
            const wrapper = document.getElementById('noticeListWrapper');
            wrapper.innerHTML = "";
            duyurular.slice(0, 5).forEach(d => {
                let badgeHTML = `<span class="badge bg-light text-dark mb-2 rounded-0" style="font-size: 0.6rem;">${d.etiket || 'DUYURU'}</span>`;
                if(d.etiket === "ACƒ∞L") badgeHTML = `<span class="badge bg-danger mb-2 rounded-0" style="font-size: 0.6rem;">üö® ACƒ∞L</span>`;
                else if(d.etiket === "ƒ∞NDƒ∞Rƒ∞M") badgeHTML = `<span class="badge bg-success mb-2 rounded-0" style="font-size: 0.6rem;">üè∑Ô∏è ƒ∞NDƒ∞Rƒ∞M</span>`;
                else if(d.etiket === "√ñNEMLƒ∞") badgeHTML = `<span class="badge bg-warning text-dark mb-2 rounded-0" style="font-size: 0.6rem;">‚≠ê √ñNEMLƒ∞</span>`;

                const div = document.createElement('div');
                div.className = 'notice-item';
                div.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-truncate" style="max-width: 70%;">${badgeHTML} <h5 class="mb-0 text-white fs-6 fw-light text-truncate">${d.baslik}</h5></div>
                        <span class="small text-muted" style="font-size: 0.7rem;">${d.tarih}</span>
                    </div>`;
                div.onclick = () => openModal(d.baslik, d.icerik, d.tarih, d.dosyaAd, d.resim);
                wrapper.appendChild(div);
            });
        }

        function reveal() {
            var reveals = document.querySelectorAll(".reveal");
            for (var i = 0; i < reveals.length; i++) {
                if (reveals[i].getBoundingClientRect().top < window.innerHeight - 50) reveals[i].classList.add("active");
            }
        }

        function handleNavbar() {
            const nav = document.getElementById('mainNav');
            if (window.scrollY > 50) nav.classList.add('scrolled');
            else nav.classList.remove('scrolled');
        }

        function openModal(title, content, date, file, imgName) {
            document.getElementById('mTitle').innerText = title;
            document.getElementById('mContent').innerText = content;
            document.getElementById('mDate').innerText = date;
            document.getElementById('mFile').innerText = file || "Yok";
            
            const mImgContainer = document.getElementById('mImgContainer');
            const mImg = document.getElementById('mImg');
            
            if(imgName && imgName !== "Yok") {
                mImg.src = imgName;
                mImgContainer.style.display = "block";
            } else {
                mImgContainer.style.display = "none";
            }
            new bootstrap.Modal(document.getElementById('infoModal')).show();
        }
    </script>
