<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Koleksiyon | SAATÜRN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&family=Playfair+Display:ital,wght@0,500;1,500&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    
    <style>
        :root { --gold: #D4AF37; --black: #050505; }
        body { background-color: var(--black); color: #f0f0f0; font-family: 'Montserrat', sans-serif; }
        .serif-font { font-family: 'Playfair Display', serif; }
        
        /* Filtre Butonları */
        .filter-btn { background: transparent; border: 1px solid #333; color: #888; padding: 8px 20px; margin: 5px; transition: 0.3s; }
        .filter-btn:hover, .filter-btn.active { border-color: var(--gold); color: #fff; background: rgba(212, 175, 55, 0.1); }
        
        /* Ürün Kartı */
        .product-card { background: rgba(255,255,255,0.02); border: 1px solid #222; padding: 30px 15px; transition: 0.3s; height: 100%; position: relative; }
        .product-card:hover { transform: translateY(-5px); border-color: var(--gold); }
        .product-img { height: 200px; width: 100%; object-fit: contain; margin-bottom: 20px; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.5)); }
        
        .product-item { display: none; } /* JS ile açılacak */
        .show { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .fav-btn { position: absolute; top: 15px; right: 15px; background: transparent; border: none; color: #555; transition: 0.3s; }
        .fav-btn.active { color: var(--gold); fill: var(--gold); }
        .fav-btn:hover { color: var(--gold); }
    </style>
</head>

<body onload="initUrunler()">

    <nav class="navbar navbar-dark bg-black border-bottom border-secondary mb-5">
        <div class="container justify-content-center">
            <span class="navbar-brand text-warning fw-bold" style="letter-spacing: 3px;">SAATÜRN</span>
        </div>
    </nav>

    <section class="container pb-5">
        <div class="text-center mb-5">
            <h1 class="display-5 text-white serif-font">2025 Koleksiyonu</h1>
            <div class="mt-4" id="filterContainer">
                <button class="filter-btn active" onclick="filterSelection('all')">TÜMÜ</button>
                <button class="filter-btn" onclick="filterSelection('prestige')">PRESTIGE</button>
                <button class="filter-btn" onclick="filterSelection('sport')">SPORT</button>
                <button class="filter-btn" onclick="filterSelection('classic')">CLASSIC</button>
                <button class="filter-btn" onclick="filterSelection('limited')">LIMITED</button>
            </div>
        </div>

        <div class="row g-4" id="urunListesiWrapper">
            </div>
    </section>

    <script>
        function initUrunler() {
            // 1. Veri Kaynağı Kontrolü
            // Eğer LocalStorage'da 'saaturnUrunler' anahtarı HİÇ OLUŞMAMIŞSA (null ise), boş bırakıyoruz.
            // Admin panelinden "Varsayılanları Yükle" denilmeden burada veri oluşmaz.
            // Bu sayede "Silince geri gelme" sorunu çözüldü.
            
            let urunler = JSON.parse(localStorage.getItem('saaturnUrunler')) || [];

            // 2. Favori Verisi Çekme
            const user = JSON.parse(localStorage.getItem("saaturn_user"));
            let favList = [];
            if(user) {
                const favKey = `saaturn_favs_${user.email}`;
                favList = JSON.parse(localStorage.getItem(favKey)) || [];
            }

            const wrapper = document.getElementById('urunListesiWrapper');
            wrapper.innerHTML = "";

            // Eğer liste boşsa uyarı ver
            if (urunler.length === 0) {
                wrapper.innerHTML = `
                    <div class="col-12 text-center text-secondary py-5">
                        <i data-feather="box" style="width: 40px; height: 40px; margin-bottom: 15px;"></i>
                        <p>Şu anda vitrinde ürün bulunmuyor.</p>
                        <small>Yönetici panelinden ürün ekleyebilirsiniz.</small>
                    </div>`;
                feather.replace();
                return;
            }

            // 3. Ürünleri Listele ve Kategorileri Eşleştir
            urunler.forEach(u => {
                let badgeHTML = u.badge ? `<span class="badge bg-warning text-dark position-absolute top-0 start-0 m-3 rounded-0">${u.badge}</span>` : "";
                
                // --- AKILLI KATEGORİ EŞLEŞTİRME ---
                // Admin'den gelen "Elite Series" -> CSS class "prestige" olur.
                let filterClass = "all";
                if(u.kat) {
                    const k = u.kat.toLowerCase();
                    if(k.includes("prestige") || k.includes("elite")) filterClass = "prestige";
                    else if(k.includes("sport") || k.includes("diver")) filterClass = "sport";
                    else if(k.includes("classic")) filterClass = "classic";
                    else if(k.includes("limited")) filterClass = "limited";
                }

                // Favori Kontrolü
                const isFav = favList.includes(u.id);
                const favClass = isFav ? "active" : "";
                const favFill = isFav ? 'fill="currentColor"' : '';

                const kart = `
                <div class="col-12 col-md-6 col-lg-4 product-item ${filterClass}">
                    <div class="product-card">
                        <button class="fav-btn ${favClass}" onclick="toggleFav(${u.id}, this)">
                            <i data-feather="heart" ${favFill}></i>
                        </button>

                        <div class="text-center mb-3">
                            ${badgeHTML}
                            <img src="${u.img}" class="product-img" alt="${u.ad}">
                        </div>
                        <div class="text-center mt-3">
                            <h4 class="text-white serif-font h5">${u.ad}</h4>
                            <p class="text-secondary small text-uppercase" style="font-size:0.7rem;">${u.kat}</p>
                            <div class="text-warning fs-5 serif-font">${u.fiyat.toLocaleString()} ₺</div>
                            <a href="#" class="btn btn-sm btn-outline-light mt-3 px-4 rounded-0" style="font-size:0.8rem;">İNCELE</a>
                        </div>
                    </div>
                </div>`;
                wrapper.innerHTML += kart;
            });

            // Filtreleri Çalıştır
            filterSelection('all');
            feather.replace();
        }

        // Filtreleme Fonksiyonu
        function filterSelection(c) {
            var x = document.getElementsByClassName("product-item");
            if (c == "all") c = "";
            for (var i = 0; i < x.length; i++) {
                x[i].classList.remove("show");
                if (x[i].className.indexOf(c) > -1) x[i].classList.add("show");
            }
            
            // Buton Aktifliği
            var btns = document.getElementsByClassName("filter-btn");
            for (var i = 0; i < btns.length; i++) {
                btns[i].classList.remove("active");
                if(btns[i].getAttribute("onclick").includes("'" + (c || 'all') + "'")) {
                    btns[i].classList.add("active");
                }
            }
        }

        // Favori Fonksiyonu
        function toggleFav(id, btn) {
            const user = JSON.parse(localStorage.getItem("saaturn_user"));
            if (!user) {
                alert("Favorilere eklemek için giriş yapmalısınız.");
                return;
            }
            
            const favKey = `saaturn_favs_${user.email}`;
            let favIds = JSON.parse(localStorage.getItem(favKey)) || [];

            if (favIds.includes(id)) {
                favIds = favIds.filter(itemId => itemId !== id);
                btn.classList.remove("active");
                btn.querySelector("svg").style.fill = "none";
            } else {
                favIds.push(id);
                btn.classList.add("active");
                btn.querySelector("svg").style.fill = "currentColor";
            }
            localStorage.setItem(favKey, JSON.stringify(favIds));
        }
    </script>
</body>
</html>
